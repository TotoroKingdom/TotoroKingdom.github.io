<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
    <meta name="keywords" content="帅">
  
  
    <meta name="description" content="Hello 每一天都要开心哦！">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    SpringSecurity |
    
    悠悠鱼儿游</title>
  
    <link rel="shortcut icon" href="favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/technology.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <section class="outer">
  <article id="post-SpringSecurity" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      SpringSecurity
    </h1>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/2021/01/05/SpringSecurity/" class="article-date">
  <time datetime="2021-01-05T06:03:50.980Z" itemprop="datePublished">2021-01-05</time>
</a>
        
      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h1 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h1><h2 id="1—导入jar包"><a href="#1—导入jar包" class="headerlink" title="1—导入jar包"></a>1—导入jar包</h2><h2 id="2—SecurityConfig"><a href="#2—SecurityConfig" class="headerlink" title="2—SecurityConfig"></a>2—SecurityConfig</h2><h2 id="3—LoginUserDetailsService"><a href="#3—LoginUserDetailsService" class="headerlink" title="3—LoginUserDetailsService"></a>3—LoginUserDetailsService</h2><h1 id="Security本质是一个过滤器链"><a href="#Security本质是一个过滤器链" class="headerlink" title="Security本质是一个过滤器链"></a>Security本质是一个过滤器链</h1><h4 id="FilterSecurityInterceptor-方法的权限过滤器"><a href="#FilterSecurityInterceptor-方法的权限过滤器" class="headerlink" title="FilterSecurityInterceptor(方法的权限过滤器)"></a>FilterSecurityInterceptor(方法的权限过滤器)</h4><h4 id="ExceptionTranslationFilter-异常过滤器"><a href="#ExceptionTranslationFilter-异常过滤器" class="headerlink" title="ExceptionTranslationFilter(异常过滤器)"></a>ExceptionTranslationFilter(异常过滤器)</h4><h4 id="UsernamePasswordAuthenticationFilter-对post请求拦截，验证用户名和密码"><a href="#UsernamePasswordAuthenticationFilter-对post请求拦截，验证用户名和密码" class="headerlink" title="UsernamePasswordAuthenticationFilter(对post请求拦截，验证用户名和密码)"></a>UsernamePasswordAuthenticationFilter(对post请求拦截，验证用户名和密码)</h4><h1 id="两个重要接口"><a href="#两个重要接口" class="headerlink" title="两个重要接口"></a>两个重要接口</h1><h2 id="UserDetailsService接口：查询数据库用户名和密码"><a href="#UserDetailsService接口：查询数据库用户名和密码" class="headerlink" title="UserDetailsService接口：查询数据库用户名和密码"></a>UserDetailsService接口：查询数据库用户名和密码</h2><p>创建类UsernamePasswordAuthenticationFilter ，重写三个方法</p>
<p>创建实现类UserDetailsService，编写查询数据过程，返回User对象。</p>
<h2 id="PasswordEncode-数据加密接口"><a href="#PasswordEncode-数据加密接口" class="headerlink" title="PasswordEncode(数据加密接口)"></a>PasswordEncode(数据加密接口)</h2><p>返回User对象里面密码加密</p>
<h1 id="认证和授权"><a href="#认证和授权" class="headerlink" title="认证和授权"></a>认证和授权</h1><h4 id="设置登录的用户名和密码"><a href="#设置登录的用户名和密码" class="headerlink" title="设置登录的用户名和密码"></a>设置登录的用户名和密码</h4><blockquote>
<h5 id="1—通过配置文件"><a href="#1—通过配置文件" class="headerlink" title="1—通过配置文件"></a>1—通过配置文件</h5><h5 id="2—通过配置类"><a href="#2—通过配置类" class="headerlink" title="2—通过配置类"></a>2—通过配置类</h5><p>1-config-SecurityConfig</p>
<p>2-继承WebSecurityConfigurerAdapter</p>
<p>3-重写configure</p>
</blockquote>
<h4 id="3—自定义编写实现类"><a href="#3—自定义编写实现类" class="headerlink" title="3—自定义编写实现类"></a>3—自定义编写实现类</h4><p>1-创建LoginUserDetailsService配置类，实现userDetailsService类。</p>
<p>2-编写接口，返回User对象，User对象有用户名和密码操作权限。</p>
<p>3-添加MyBatis，mysql，lombok依赖</p>
<p>4-创建数据库表</p>
<p>5-创建mapper接口</p>
<p>6-在LoginUserDetailsService调用mapper接口里面的方法查询数据库认证。</p>
<p>7-在启动类添加mapperScan</p>
<p>8-配置数据库信息</p>
<h4 id="4—自定义登录页面，登录页面无需认证可访问"><a href="#4—自定义登录页面，登录页面无需认证可访问" class="headerlink" title="4—自定义登录页面，登录页面无需认证可访问"></a>4—自定义登录页面，登录页面无需认证可访问</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">protected void configure(HttpSecurity http) throws Exception&#123;</span><br><span class="line">    &#x2F;&#x2F;跳转到自定义登录页面</span><br><span class="line">    http.formLogin()</span><br><span class="line">            .loginPage(&quot;&#x2F;login.html&quot;)</span><br><span class="line">            .loginProcessingUrl(&quot;&#x2F;user&#x2F;login&quot;)&#x2F;&#x2F;登录访问路径</span><br><span class="line">            .defaultSuccessUrl(&quot;&#x2F;test&#x2F;index&quot;).permitAll()&#x2F;&#x2F;登录成功后跳转的路径</span><br><span class="line">            .and().authorizeRequests()</span><br><span class="line">                .antMatchers(&quot;&#x2F;&quot;,&quot;&#x2F;test&#x2F;hello&quot;,&quot;&#x2F;user&#x2F;login&quot;).permitAll() &#x2F;&#x2F;不需要认证的路径</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and().csrf().disable();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5—基于角色或权限的访问控制"><a href="#5—基于角色或权限的访问控制" class="headerlink" title="5—基于角色或权限的访问控制"></a>5—基于角色或权限的访问控制</h4><h5 id="hasAuthority（针对一个权限进行操作）"><a href="#hasAuthority（针对一个权限进行操作）" class="headerlink" title="hasAuthority（针对一个权限进行操作）"></a>hasAuthority（针对一个权限进行操作）</h5><p>1-在配置类中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(&quot;&#x2F;test&#x2F;index&quot;).hasAuthority(&quot;admin&quot;)&#x2F;&#x2F;拥有此权限才能访问该页面</span><br></pre></td></tr></table></figure>
<p>2-在LoginUserDetailsService中，把返回的User对象设置权限。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;GrantedAuthority&gt; auths &#x3D;</span><br><span class="line">        AuthorityUtils.commaSeparatedStringToAuthorityList(&quot;admin&quot;);</span><br></pre></td></tr></table></figure>
<h5 id="hasAnyAuthority（针对多个权限进行操作）"><a href="#hasAnyAuthority（针对多个权限进行操作）" class="headerlink" title="hasAnyAuthority（针对多个权限进行操作）"></a>hasAnyAuthority（针对多个权限进行操作）</h5><h5 id="hasRole（针对一个角色进行操作）"><a href="#hasRole（针对一个角色进行操作）" class="headerlink" title="hasRole（针对一个角色进行操作）"></a>hasRole（针对一个角色进行操作）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(&quot;&#x2F;test&#x2F;index&quot;).hasRole(&quot;sale&quot;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AuthorityUtils.commaSeparatedStringToAuthorityList(&quot;admin,ROLE_sale&quot;);</span><br></pre></td></tr></table></figure>
<h5 id="hasAnyRole（针对多个角色进行操作）"><a href="#hasAnyRole（针对多个角色进行操作）" class="headerlink" title="hasAnyRole（针对多个角色进行操作）"></a>hasAnyRole（针对多个角色进行操作）</h5><h1 id="认证授权注解使用"><a href="#认证授权注解使用" class="headerlink" title="认证授权注解使用"></a>认证授权注解使用</h1><h2 id="开启注解"><a href="#开启注解" class="headerlink" title="开启注解"></a>开启注解</h2><h4 id="Secured（用户具有某个角色，可以访问方法）"><a href="#Secured（用户具有某个角色，可以访问方法）" class="headerlink" title="@Secured（用户具有某个角色，可以访问方法）"></a>@Secured（用户具有某个角色，可以访问方法）</h4><p>1-启动类（配置类）开启注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@EnableGlobalMethodSecurity(securedEnabled &#x3D; true)</span><br></pre></td></tr></table></figure>
<p>2-在controller的方法上使用注解，设置角色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Secured(&#123;&quot;ROLE_admin&quot;,&quot;ROLE_manager&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="PreAuthorize（进入方法前的权限验证，将登录用户的roles-permissions参数传到方法中）"><a href="#PreAuthorize（进入方法前的权限验证，将登录用户的roles-permissions参数传到方法中）" class="headerlink" title="@PreAuthorize（进入方法前的权限验证，将登录用户的roles/permissions参数传到方法中）"></a>@PreAuthorize（进入方法前的权限验证，将登录用户的roles/permissions参数传到方法中）</h4><p>1-启动类（配置类）开启注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@EnableGlobalMethodSecurity(securedEnabled &#x3D; true,prePostEnabled &#x3D; true)</span><br></pre></td></tr></table></figure>
<p>2-在controller的方法上使用注解，设置权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@PreAuthorize(&quot;hasAnyAuthority(&#39;admin&#39;)&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="PostAuthorize（在方法执行后再进行权限验证，适合验证有返回值的权限）"><a href="#PostAuthorize（在方法执行后再进行权限验证，适合验证有返回值的权限）" class="headerlink" title="@PostAuthorize（在方法执行后再进行权限验证，适合验证有返回值的权限）"></a>@PostAuthorize（在方法执行后再进行权限验证，适合验证有返回值的权限）</h4><p>1-启动类（配置类）开启注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@EnableGlobalMethodSecurity(securedEnabled &#x3D; true,prePostEnabled &#x3D; true)</span><br></pre></td></tr></table></figure>
<p>2-在controller的方法上使用注解，设置角色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@PostAuthorize(&quot;hasAnyAuthority(&#39;admins&#39;)&quot;)</span><br><span class="line">@GetMapping(&quot;update&quot;)</span><br><span class="line">public String update()&#123;</span><br><span class="line">    System.out.println(&quot;update!!!!!!&quot;);</span><br><span class="line">    return &quot;hello update&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="PostFilter（方法返回数据进行过滤）"><a href="#PostFilter（方法返回数据进行过滤）" class="headerlink" title="@PostFilter（方法返回数据进行过滤）"></a>@PostFilter（方法返回数据进行过滤）</h4><h4 id="PreFilter（传入方法数据进行过滤）"><a href="#PreFilter（传入方法数据进行过滤）" class="headerlink" title="@PreFilter（传入方法数据进行过滤）"></a>@PreFilter（传入方法数据进行过滤）</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/01/05/SpringSecurity/" data-id="ckvt4fghw0018nwuceju755bl"
         class="article-share-link">分享</a>
      
    </footer>

  </div>

  
    
  <nav class="article-nav">
    
      <a href="/2021/01/06/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            权限管理需求分析
          
        </div>
      </a>
    
    
      <a href="/2021/01/01/%E8%81%94%E6%83%B3%E8%AE%B0%E5%BF%86%E6%B3%95/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">联想记忆法</div>
      </a>
    
  </nav>


  

  
    
  

</article>



</section>
    </div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/search.js"></script>




<script src="/js/technology.js"></script>


  </div>
</body>
</html>